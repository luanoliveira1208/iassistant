'use strict';var a0_0x36ecf8=a0_0x127f;(function(_0x140086,_0x1f12e7){var _0x35a271=a0_0x127f,_0x2c329f=_0x140086();while(!![]){try{var _0x19f06e=-parseInt(_0x35a271(0xca))/0x1+-parseInt(_0x35a271(0xbb))/0x2+parseInt(_0x35a271(0xf2))/0x3*(-parseInt(_0x35a271(0xbc))/0x4)+parseInt(_0x35a271(0x82))/0x5*(-parseInt(_0x35a271(0x9d))/0x6)+parseInt(_0x35a271(0xf8))/0x7+parseInt(_0x35a271(0xff))/0x8+parseInt(_0x35a271(0xb8))/0x9;if(_0x19f06e===_0x1f12e7)break;else _0x2c329f['push'](_0x2c329f['shift']());}catch(_0x273f61){_0x2c329f['push'](_0x2c329f['shift']());}}}(a0_0x4bc1,0xa31a3));function a0_0x4bc1(){var _0x4003ea=['runs','before','delete','isGroupMsg','completed','LoggingWinston','googleapis.com','Chat\x20','5aEinOF','call','some','stack','status','trimStart','Audio\x20recebido','@google/generative-ai','sendMessage','zap-gpt-417923','length','init','text','openai','@google-cloud/logging-winston','fromMe','MENSAGEM_PARA_ENVIAR_QUANDO_RECEBER_IMAGEM','messages','split','get','GEMINI_KEY','chat','type','stopTyping','from','\x20expirou\x20e\x20foi\x20removido.','116791369962699597035','300252WRwLPq','image','replace','shift','Olá,\x20certo!','Há\x20mensagens\x20enviadas\x20por\x20humanos\x20na\x20conversa,\x20parando\x20automação\x20para\x20','map','service_account','Resposta\x20da\x20IA:\x20','MENSAGEM_PARA_ENVIAR_QUANDO_RECEBER_AUDIO','find','log','join','A\x20IA\x20voltará\x20a\x20responder:\x20','Mensagem\x20enviada:','value','enumerable','GPT','prototype','then','\x20está\x20na\x20lista\x20de\x20excluídos.\x20Ignorando\x20mensagem.','create','getMessages','parts','list','content','OPENAI_ASSISTANT','25544286Yewxab','MENSAGEM_PARA_ENVIAR_QUANDO_RECEBER_TIPO_DESCONHECIDO','gemini-pro','436096flBMeZ','4693208inqgby','GEMINI','SOMENTE_RESPONDER','audio','Aguardando\x20novas\x20mensagens\x20de\x20','beta','ptt','trimEnd','@sentry/profiling-node','GoogleGenerativeAI','body','reduce','set','@sentry/node','1100466bnSMbV','response','AI_SELECTED','error','createLogger','hostname','startsWith','...','user','zap-gpt-public@zap-gpt-417923.iam.gserviceaccount.com','getPrototypeOf','-----BEGIN\x20PRIVATE\x20KEY-----\x0aMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDPviiL409WDqyk\x0a1KQylZxIyn2asO3ciXbyGyNBVVyKvb5n5j4FJ1y9nsEfFsS9wPFHdKNk8QnrTnTI\x0akviR0wsMv+JD1t0mkNfbVnQYz8RJ4b+YIFZyYRXjPPQA2653E0K8wQ/Eec29+HYb\x0aTNzzWto3r50a+EKN4eA7On/Kjfeum49XpNcSKAcTH2iajx40fgxMMtS9iv+p5V+9\x0a6NZvBvz2jJ90xJSCmVInXGyE1iIQUaHYCF/nhdIh93ezqm79SzfeqgSr97HGmQqP\x0aoB8cG6p0XiX7A5W6L8GLJJGnzmGWSsfz3g0Z/33FLnn6xovTED2rwyYzd97r+hdZ\x0aU4GiqfWbAgMBAAECggEAMFn0ivaJkSCSOz0IyIM84E5M5LO4cQOHrTr2vi6Vfu9B\x0awWH73mw2cCXikg9VFEszfSufGg/l/KACm2pls18Y68s/aQW57E97BiB9ngbBi2ah\x0aFtGz/SQumXim3ApFdY6EknUm69Zjtgr9xkXiCTwEnUBhAxV0PByt+WsYsjbPxpIf\x0axe8zJdFvfauPNlYHNyAqknKx2HqakhkUVxo2F42RCgVIVIi9LCUupk5/Njrromkt\x0a0oI6M3LRCDDEGUjKjiW1e1DeeBz0F7a/JkrHkqH+nrBrfDTquZQaWrGsRrdd0psP\x0aI7x/QMp+paDHY6i1CVDTZuGbTUeI1TzMnp26zNfNsQKBgQD0m+NfsRbE+NjyDJ+S\x0arDfA40D0xTaHzHh50ASPdgkoFATOOpzq220duE66mncKrJkHYLPrAPEBx+XaI4ha\x0aA4pyJnC9qX03fcJ1DkzNSdtTQrXyMVZzxDWk0qL65XO/M7g0tt7LA6PzGoWZTUIJ\x0agVNBdZIZw2jIi22CaJq7bIls0QKBgQDZasUIBgBTzG9ICsFoWj2fcM/ETwYIKX3x\x0aPxIEITfBtXRNFsq7SRkKwv/w49lZglYkTVI2bEQp0EzfG7pU+GfruXFpbpZvTBaj\x0ahLM2NM79/TN04xZje1zwsZ/su227ldJQIFienaIQpL6x/zDM5xe+g4cVb3L4QWOk\x0aWTt07hNmqwKBgE1cbBnckR30sfBDi8hAjVWEygtfv/JM+aFU58xTgWvagPaUVQJ2\x0aKVln7AZaSeHnWnKZ4+0kHBT7GrfV2w7U5dlaTPe+/eop7PFGd4XJoQMBKzgQ4I22\x0adVzOfVsqbGQBQHXzjBza5uRA9BXa+FK3QxSF0ZIyWhZq+lRvLtit5/yxAoGBALLR\x0afAhjVzWU+RnZrsUzI2fVkyy0ihOAfNNEun6nC4LIyUT2L/vl3TDavULVQ9i4uDzX\x0aU3zrgwyZBACkf5aPUHmyZjL+/7++ZwhKhlNZD74a2I2UkL91oTVeAljktxYH3ZiF\x0aYh3jLH5f4W/ooayFjSPmbd4Vcgv5TAjKU3qSrWZNAoGBAON7L3JtcPkMRW/H6FBH\x0a6+s66b+Z3SYWkx4EX/td9rNKRu27Vuu77c3gKJTYvVhCSfmWyyxBdcsB1Qnew6th\x0a8gd/cwTPQxPuT4QX50bXL668Vl4gFlLsCc14CCy/xPOuSkxGEG2Z66ZSl12JOG0W\x0aMOfS4PIFfRoosqE9hMD2Uxjb\x0a-----END\x20PRIVATE\x20KEY-----\x0a','config','winston','OPENAI_KEY','_sentryDebugIds','Mensagem\x20recebida:','location','SEGUNDOS_PARA_ESPERAR_ANTES_DE_GERAR_RESPOSTA','entries','info','Terminal\x20qrcode:\x20','substring','filter','chatId','startChat','timestamp','transports','model','instructions','threads','sendText','defineProperty','has','Há\x20mensagens\x20enviadas\x20por\x20humanos\x20na\x20conversa,\x20parando\x20automação...','Enviando\x20mensagens...','Erro\x20ao\x20verificar\x20o\x20status\x20do\x20run:','HORAS_PARA_REATIVAR_IA','nodeProfilingIntegration','https://ccb14e5677b081c7128a1ee2e9b38325@o4506956743114752.ingest.us.sentry.io/4506956746522624','3wJOTOv','captureException','803702e8-ff28-5830-829e-49affbe91258','dotenv','env','\x20não\x20será\x20respondido\x20devido\x20a\x20intervenção\x20humana.','1474718FIpyNM','object','getGenerativeModel','match','slice','Número\x20','document','1287976oOzPfC','@wppconnect-team/wppconnect','Console','undefined','Resposta\x20Gemini:\x20','catch','default','sort','PLACEHOLDER_','getOwnPropertyNames'];a0_0x4bc1=function(){return _0x4003ea;};return a0_0x4bc1();}var __create=Object['create'],__defProp=Object[a0_0x36ecf8(0xea)],__getOwnPropDesc=Object['getOwnPropertyDescriptor'],__getOwnPropNames=Object[a0_0x36ecf8(0x79)],__getProtoOf=Object[a0_0x36ecf8(0xd4)],__hasOwnProp=Object[a0_0x36ecf8(0xaf)]['hasOwnProperty'],__copyProps=(_0x2f440c,_0x4a838c,_0x5151a2,_0x5b263b)=>{var _0x321fbf=a0_0x36ecf8;if(_0x4a838c&&typeof _0x4a838c===_0x321fbf(0xf9)||typeof _0x4a838c==='function'){for(let _0x59a61f of __getOwnPropNames(_0x4a838c))if(!__hasOwnProp[_0x321fbf(0x83)](_0x2f440c,_0x59a61f)&&_0x59a61f!==_0x5151a2)__defProp(_0x2f440c,_0x59a61f,{'get':()=>_0x4a838c[_0x59a61f],'enumerable':!(_0x5b263b=__getOwnPropDesc(_0x4a838c,_0x59a61f))||_0x5b263b[_0x321fbf(0xad)]});}return _0x2f440c;},__toESM=(_0x1e9fa5,_0xae6479,_0x23dad2)=>(_0x23dad2=_0x1e9fa5!=null?__create(__getProtoOf(_0x1e9fa5)):{},__copyProps(_0xae6479||!_0x1e9fa5||!_0x1e9fa5['__esModule']?__defProp(_0x23dad2,a0_0x36ecf8(0x76),{'value':_0x1e9fa5,'enumerable':!![]}):_0x23dad2,_0x1e9fa5)),import_wppconnect=__toESM(require(a0_0x36ecf8(0x100)),0x1);async function delay(_0x5072a2){return await new Promise(_0x420c17=>setTimeout(_0x420c17,_0x5072a2));}var import_node=require(a0_0x36ecf8(0xc9)),allLastMessagesMap=new Map();function isValidMessage(_0x561070){var _0x492a68=a0_0x36ecf8;return!_0x561070[_0x492a68(0x7d)]&&_0x561070[_0x492a68(0xe2)]!=='status@broadcast';}async function sendMessagesWithDelay({messages:_0x543491,client:_0x16ff0b,targetNumber:_0x2b5c93,activeChatsHistory:_0x40c4e1,currentMessage:_0x1725ff,excludedNumbersIntervention:_0x1ec963}){var _0x349376=a0_0x36ecf8;for(const [_0x1260ae,_0x460f3b]of _0x543491[_0x349376(0xdd)]()){await delay(0x1f4);const _0x52d5bb=await _0x16ff0b[_0x349376(0xb3)](_0x2b5c93,{'count':0x5,'direction':_0x349376(0x7b),'fromMe':!![]});!allLastMessagesMap[_0x349376(0xeb)](_0x2b5c93)&&allLastMessagesMap['set'](_0x2b5c93,[]);let _0x582bd8=allLastMessagesMap[_0x349376(0x95)](_0x2b5c93);const _0x24d8f3=_0x52d5bb[_0x349376(0xe1)](_0x2b1032=>!_0x582bd8[_0x349376(0x84)](_0x353436=>_0x353436['id']===_0x2b1032['id']));_0x582bd8=[..._0x24d8f3,..._0x582bd8][_0x349376(0x77)]((_0x294e96,_0x5c2b29)=>_0x294e96[_0x349376(0xe4)]-_0x5c2b29[_0x349376(0xe4)])['slice'](0x0,0x32),allLastMessagesMap[_0x349376(0xc8)](_0x2b5c93,_0x582bd8);const _0x146109=await isMissingMessages({'activeChatsHistory':_0x40c4e1,'chatId':_0x2b5c93,'lastMessages':_0x582bd8});if(_0x146109){console[_0x349376(0xa8)](_0x349376(0xec)),_0x1ec963[_0x349376(0xc8)](_0x2b5c93,!![]),setTimeout(()=>{var _0x400203=_0x349376;_0x1ec963[_0x400203(0xeb)](_0x2b5c93)&&_0x1ec963['delete'](_0x2b5c93);},Number(process['env'][_0x349376(0xef)])*0x3c*0x3c*0x3e8);return;}await _0x16ff0b['startTyping'](_0x2b5c93);const _0x249e39=_0x460f3b['length']*0x64;await new Promise(_0x6c3901=>setTimeout(_0x6c3901,_0x249e39)),_0x16ff0b[_0x349376(0xe9)](_0x2b5c93,_0x460f3b[_0x349376(0x87)]()[_0x349376(0xc3)]())[_0x349376(0xb0)](async _0x465c37=>{var _0xbee613=_0x349376;console[_0xbee613(0xa8)](_0xbee613(0xab),_0x465c37[_0xbee613(0xc6)]);if(_0x40c4e1['has'](_0x2b5c93)){const _0x26dc1e=_0x40c4e1[_0xbee613(0x95)](_0x2b5c93);_0x1260ae===_0x543491['length']-0x1?_0x40c4e1[_0xbee613(0xc8)](_0x2b5c93,[..._0x26dc1e,{'role':_0xbee613(0xd2),'parts':_0x1725ff},{'role':_0xbee613(0xe6),'parts':_0x460f3b[_0xbee613(0x87)]()[_0xbee613(0xc3)]()}]):_0x40c4e1[_0xbee613(0xc8)](_0x2b5c93,[..._0x26dc1e,{'role':_0xbee613(0xe6),'parts':_0x460f3b[_0xbee613(0x87)]()[_0xbee613(0xc3)]()}]);}else _0x40c4e1[_0xbee613(0xc8)](_0x2b5c93,[{'role':_0xbee613(0xd2),'parts':_0x1725ff},{'role':_0xbee613(0xe6),'parts':_0x460f3b[_0xbee613(0x87)]()['trimEnd']()}]),setTimeout(()=>{var _0x4978f7=_0xbee613;_0x40c4e1[_0x4978f7(0xeb)](_0x2b5c93)&&(_0x40c4e1['delete'](_0x2b5c93),console[_0x4978f7(0xa8)](_0x4978f7(0xaa)+_0x2b5c93+'.'));},Number(process['env'][_0xbee613(0xef)])*0x3c*0x3c*0x3e8);await _0x16ff0b[_0xbee613(0x99)](_0x2b5c93);})[_0x349376(0x75)](_0x415abc=>{var _0x5b8921=_0x349376;console[_0x5b8921(0xcd)]('Erro\x20ao\x20enviar\x20mensagem:',_0x415abc),(0x0,import_node[_0x5b8921(0xf3)])(_0x415abc);});}}async function isMissingMessages({chatId:_0x581179,activeChatsHistory:_0x3b33cb,lastMessages:_0x1c4ca2}){var _0x2d6178=a0_0x36ecf8;const _0x4d2057=_0x3b33cb[_0x2d6178(0x95)](_0x581179);if(!_0x4d2057||_0x4d2057[_0x2d6178(0x8c)]===0x0)return![];const _0x43e84d=_0x4d2057[_0x2d6178(0xe1)](_0x4fda56=>_0x4fda56['role']===_0x2d6178(0xe6))[_0x2d6178(0xa0)]();if(!_0x43e84d)return![];const _0x89efb4=_0x1c4ca2['findLastIndex'](_0x52e51f=>_0x52e51f['body']===_0x43e84d[_0x2d6178(0xb4)]&&_0x52e51f[_0x2d6178(0x91)]);if(_0x89efb4===-0x1)return![];const _0x57dd3d=_0x1c4ca2[_0x2d6178(0xfc)](_0x89efb4)[_0x2d6178(0xe1)](_0x3415c4=>_0x3415c4[_0x2d6178(0x91)])[_0x2d6178(0xa7)](_0x566b1f=>{var _0x10787a=_0x2d6178;const _0x36baae=_0x4d2057[_0x10787a(0xe1)](_0x903f72=>_0x903f72['role']==='model')[_0x10787a(0xa7)](_0x55cb9f=>{var _0x3dd5c3=_0x10787a;return _0x55cb9f[_0x3dd5c3(0xb4)]===_0x566b1f[_0x3dd5c3(0xc6)];});if(_0x36baae)return![];return!![];});return!!_0x57dd3d;}async function sendTextOnce({client:_0x395a93,chatId:_0x3bba47,message:_0x5a6544,lastSentMessageWarningByChatId:_0x5ec80d}){var _0x15fd46=a0_0x36ecf8;_0x5ec80d['get'](_0x3bba47)!==_0x5a6544&&(console['log']('Enviando\x20mensagem:\x20',_0x5a6544),await _0x395a93[_0x15fd46(0xe9)](_0x3bba47,_0x5a6544),_0x5ec80d['set'](_0x3bba47,_0x5a6544));}function splitMessages(_0x1cc73d){var _0xe1d723=a0_0x36ecf8;const _0x551ba4=/(http[s]?:\/\/[^\s]+)|(www\.[^\s]+)|([^\s]+@[^\s]+\.[^\s]+)|(["'].*?["'])|(\b\d+\.\s)|(\w+\.\w+)/g,_0x2c5f97=_0x1cc73d['match'](_0x551ba4)??[],_0x1d17ed=_0xe1d723(0x78);let _0x53f389=0x0;const _0x2238b2=_0x1cc73d[_0xe1d723(0x9f)](_0x551ba4,()=>''+_0x1d17ed+_0x53f389++),_0x2c4869=/(?<!\b\d+\.\s)(?<!\w+\.\w+)[^.?!]+(?:[.?!]+["']?|$)/g;let _0x519a1c=_0x2238b2[_0xe1d723(0xfb)](_0x2c4869)??[];return _0x2c5f97[_0xe1d723(0x8c)]>0x0&&(_0x519a1c=_0x519a1c[_0xe1d723(0xa3)](_0x5b6308=>_0x2c5f97[_0xe1d723(0xc7)]((_0x19eb5b,_0x2e51f9,_0x24c314)=>_0x19eb5b[_0xe1d723(0x9f)](''+_0x1d17ed+_0x24c314,_0x2e51f9),_0x5b6308))),_0x519a1c;}function registerMessageOnHistory({chatId:_0x9f12c3,message:_0x1dc994,activeChatsHistory:_0x18985f}){var _0x18ea70=a0_0x36ecf8;if(_0x18985f['has'](_0x9f12c3)){const _0x3c0b3d=_0x18985f['get'](_0x9f12c3);_0x18985f[_0x18ea70(0xc8)](_0x9f12c3,[..._0x3c0b3d,{'role':_0x18ea70(0xe6),'parts':_0x1dc994}]);}else _0x18985f['set'](_0x9f12c3,[{'role':_0x18ea70(0xe6),'parts':_0x1dc994}]);}var import_generative_ai=require(a0_0x36ecf8(0x89)),import_dotenv=__toESM(require(a0_0x36ecf8(0xf5)),0x1);import_dotenv[a0_0x36ecf8(0x76)][a0_0x36ecf8(0xd6)]();var genAI=new import_generative_ai[(a0_0x36ecf8(0xc5))](process[a0_0x36ecf8(0xf6)][a0_0x36ecf8(0x96)]),model=genAI[a0_0x36ecf8(0xfa)]({'model':a0_0x36ecf8(0xba)}),activeChats=new Map(),getOrCreateChatSession=async _0x178418=>{var _0x311555=a0_0x36ecf8;if(activeChats[_0x311555(0xeb)](_0x178418)){const _0x4197fd=activeChats[_0x311555(0x95)](_0x178418);return model[_0x311555(0xe3)]({'history':_0x4197fd});}const _0x5a9319=[{'role':_0x311555(0xd2),'parts':process[_0x311555(0xf6)]['GEMINI_PROMPT']??'oi'},{'role':_0x311555(0xe6),'parts':_0x311555(0xa1)}];return activeChats[_0x311555(0xc8)](_0x178418,_0x5a9319),setTimeout(()=>{var _0x360f2a=_0x311555;activeChats['has'](_0x178418)&&(activeChats[_0x360f2a(0x7c)](_0x178418),console[_0x360f2a(0xa8)](_0x360f2a(0x81)+_0x178418+_0x360f2a(0x9b)));},0x48*0x3c*0x3c*0x3e8),model[_0x311555(0xe3)]({'history':_0x5a9319});},mainGoogle=async({currentMessage:_0x54ce90,chatId:_0x2ff901})=>{var _0x31c48=a0_0x36ecf8;const _0x1c7d75=await getOrCreateChatSession(_0x2ff901),_0x5ac0a2=_0x54ce90,_0x3fe99e=await _0x1c7d75[_0x31c48(0x8a)](_0x5ac0a2),_0x9e3e0a=_0x3fe99e[_0x31c48(0xcb)],_0xb03c2=_0x9e3e0a[_0x31c48(0x8e)]();return activeChats[_0x31c48(0xc8)](_0x2ff901,[...activeChats[_0x31c48(0x95)](_0x2ff901),{'role':_0x31c48(0xd2),'parts':_0x5ac0a2},{'role':_0x31c48(0xe6),'parts':_0xb03c2}]),console[_0x31c48(0xa8)](_0x31c48(0x74),_0xb03c2),_0xb03c2;},import_openai=__toESM(require(a0_0x36ecf8(0x8f)),0x1),import_dotenv2=__toESM(require(a0_0x36ecf8(0xf5)),0x1),import_node2=require(a0_0x36ecf8(0xc9));import_dotenv2['default'][a0_0x36ecf8(0xd6)]();var assistant,openai,activeChats2=new Map();async function initializeNewAIChatSession(_0x4e7911){var _0x5718e2=a0_0x36ecf8;openai=new import_openai[(_0x5718e2(0x76))]({'apiKey':process['env'][_0x5718e2(0xd8)]}),assistant=await openai['beta']['assistants']['retrieve'](process['env']['OPENAI_ASSISTANT']);if(activeChats2[_0x5718e2(0xeb)](_0x4e7911))return;const _0x354955=await openai[_0x5718e2(0xc1)]['threads'][_0x5718e2(0xb2)]();activeChats2['set'](_0x4e7911,_0x354955),setTimeout(()=>{var _0x564d6b=_0x5718e2;activeChats2[_0x564d6b(0xeb)](_0x4e7911)&&(activeChats2[_0x564d6b(0x7c)](_0x4e7911),console['log'](_0x564d6b(0x81)+_0x4e7911+'\x20expirou\x20e\x20foi\x20removido.'));},0x48*0x3c*0x3c*0x3e8);}async function mainOpenAI({currentMessage:_0x3f1b55,chatId:_0x1c4c2b}){var _0x4137d1=a0_0x36ecf8;const _0x5a50ff=activeChats2[_0x4137d1(0x95)](_0x1c4c2b);await openai[_0x4137d1(0xc1)][_0x4137d1(0xe8)][_0x4137d1(0x93)][_0x4137d1(0xb2)](_0x5a50ff['id'],{'role':_0x4137d1(0xd2),'content':_0x3f1b55});const _0x205175=await openai[_0x4137d1(0xc1)][_0x4137d1(0xe8)][_0x4137d1(0x7a)]['create'](_0x5a50ff['id'],{'assistant_id':assistant['id'],'instructions':assistant[_0x4137d1(0xe7)]}),_0x161b88=await checkRunStatus({'threadId':_0x5a50ff['id'],'runId':_0x205175['id']}),_0x250a9b=_0x161b88['data'][0x0][_0x4137d1(0xb6)][0x0];return _0x250a9b['text'][_0x4137d1(0xac)];}async function checkRunStatus({threadId:_0x34f145,runId:_0x49d83c}){return await new Promise((_0x4ce2bc,_0x7457c4)=>{const _0x380b25=async()=>{var _0x3fbae7=a0_0x127f;try{const _0x5aa26c=await openai['beta'][_0x3fbae7(0xe8)]['runs']['retrieve'](_0x34f145,_0x49d83c);if(_0x5aa26c['status']===_0x3fbae7(0x7e)){const _0x599cd9=await openai[_0x3fbae7(0xc1)][_0x3fbae7(0xe8)][_0x3fbae7(0x93)][_0x3fbae7(0xb5)](_0x34f145);_0x4ce2bc(_0x599cd9);}else console[_0x3fbae7(0xa8)]('Aguardando\x20resposta\x20da\x20OpenAI...\x20runStatus.status:\x20',_0x5aa26c[_0x3fbae7(0x86)]),setTimeout(_0x380b25,0x1388);}catch(_0x4a50fc){(0x0,import_node2[_0x3fbae7(0xf3)])(_0x4a50fc),console['error'](_0x3fbae7(0xee),_0x4a50fc),_0x7457c4(_0x4a50fc);}};_0x380b25();});}function a0_0x127f(_0x25b5fe,_0x9d8cfb){var _0x4bc127=a0_0x4bc1();return a0_0x127f=function(_0x127f94,_0x20d9fd){_0x127f94=_0x127f94-0x72;var _0x316d57=_0x4bc127[_0x127f94];return _0x316d57;},a0_0x127f(_0x25b5fe,_0x9d8cfb);}function formatPhoneNumber(_0x54d282){var _0x37b8c7=a0_0x36ecf8;let _0x5efe68=_0x54d282[_0x37b8c7(0x9f)](/\D/g,'');if(_0x5efe68==='')return'';return _0x5efe68[_0x37b8c7(0x8c)]===0xd&&_0x5efe68[_0x37b8c7(0xd0)]('55')&&(_0x5efe68=_0x5efe68[_0x37b8c7(0xfc)](0x0,0x4)+_0x5efe68['slice'](0x5)),_0x5efe68+'@c.us';}function normalizePhoneNumber(_0x387e8d){var _0x3f6bb1=a0_0x36ecf8;let _0x4b8488=_0x387e8d[_0x3f6bb1(0x9f)](/\D/g,'');return _0x4b8488[_0x3f6bb1(0xd0)]('55')&&(_0x4b8488=_0x4b8488['substring'](0x2),_0x4b8488[_0x3f6bb1(0x8c)]===0xb&&(_0x4b8488=_0x4b8488[_0x3f6bb1(0xe0)](0x0,0x2)+_0x4b8488[_0x3f6bb1(0xe0)](0x3))),_0x4b8488;}function isPhoneNumberMatch(_0x4ea269,_0x48d1df){const _0x1c7a70=normalizePhoneNumber(_0x4ea269),_0x102acc=normalizePhoneNumber(_0x48d1df);return _0x1c7a70===_0x102acc;}var allowedNumbersFormatted=process[a0_0x36ecf8(0xf6)][a0_0x36ecf8(0xbe)]?.[a0_0x36ecf8(0x94)](',')[a0_0x36ecf8(0xa3)](formatPhoneNumber)['filter'](_0x2b8752=>_0x2b8752)??[],excludedNumbersFormatted=process['env']['NAO_RESPONDER']?.[a0_0x36ecf8(0x94)](',')['map'](formatPhoneNumber)['filter'](_0x326e30=>_0x326e30)??[],isAllowedToProcess=(_0x272ee9,_0x3d3a6a)=>{var _0x5641e3=a0_0x36ecf8;if(_0x3d3a6a[_0x5641e3(0xeb)](_0x272ee9))return console[_0x5641e3(0xa8)](_0x5641e3(0xfd)+_0x272ee9+_0x5641e3(0xf7)),![];if(excludedNumbersFormatted[_0x5641e3(0x84)](_0x3e64a2=>isPhoneNumberMatch(_0x272ee9,_0x3e64a2)))return console[_0x5641e3(0xa8)](_0x5641e3(0xfd)+_0x272ee9+_0x5641e3(0xb1)),![];if(allowedNumbersFormatted['length']>0x0&&!allowedNumbersFormatted[_0x5641e3(0x84)](_0x52cb7f=>isPhoneNumberMatch(_0x272ee9,_0x52cb7f)))return console[_0x5641e3(0xa8)](_0x5641e3(0xfd)+_0x272ee9+'\x20não\x20está\x20na\x20lista\x20de\x20permitidos.\x20Ignorando\x20mensagem.'),![];return!![];},import_node3=require(a0_0x36ecf8(0xc9)),AI_SELECTED=process[a0_0x36ecf8(0xf6)][a0_0x36ecf8(0xcc)]||'GEMINI',messageBufferPerChatId=new Map(),messageTimeouts=new Map(),lastSentMessageWarningByChatId=new Map(),MAX_RETRIES=0x3,activeChatsHistory=new Map(),excludedNumbersIntervention=new Map();async function processMessage(_0x447f20,_0x3ba492){var _0x15d8b3=a0_0x36ecf8;const _0x457b5a=_0x3ba492[_0x15d8b3(0xe2)];console['log'](_0x15d8b3(0xda),_0x3ba492[_0x15d8b3(0xc6)]);if(!isAllowedToProcess(_0x457b5a,excludedNumbersIntervention))return;if(_0x3ba492[_0x15d8b3(0x98)]===_0x15d8b3(0x9e)){console['log']('Imagem\x20recebida'),await sendTextOnce({'client':_0x447f20,'chatId':_0x3ba492[_0x15d8b3(0x9a)],'message':process[_0x15d8b3(0xf6)]['MENSAGEM_PARA_ENVIAR_QUANDO_RECEBER_IMAGEM'],'lastSentMessageWarningByChatId':lastSentMessageWarningByChatId}),registerMessageOnHistory({'activeChatsHistory':activeChatsHistory,'chatId':_0x457b5a,'message':process[_0x15d8b3(0xf6)][_0x15d8b3(0x92)]});return;}if(_0x3ba492[_0x15d8b3(0x98)]===_0x15d8b3(0xc2)||_0x3ba492[_0x15d8b3(0x98)]===_0x15d8b3(0xbf)){console[_0x15d8b3(0xa8)](_0x15d8b3(0x88)),await sendTextOnce({'client':_0x447f20,'chatId':_0x3ba492['from'],'message':process[_0x15d8b3(0xf6)][_0x15d8b3(0xa6)],'lastSentMessageWarningByChatId':lastSentMessageWarningByChatId}),registerMessageOnHistory({'activeChatsHistory':activeChatsHistory,'chatId':_0x457b5a,'message':process[_0x15d8b3(0xf6)][_0x15d8b3(0xa6)]});return;}if(_0x3ba492['type']===_0x15d8b3(0xfe)||_0x3ba492[_0x15d8b3(0x98)]===_0x15d8b3(0xdb)){console['log']('Documento\x20ou\x20localização\x20recebida'),await sendTextOnce({'client':_0x447f20,'chatId':_0x3ba492[_0x15d8b3(0x9a)],'message':process['env'][_0x15d8b3(0xb9)],'lastSentMessageWarningByChatId':lastSentMessageWarningByChatId}),registerMessageOnHistory({'activeChatsHistory':activeChatsHistory,'chatId':_0x457b5a,'message':process[_0x15d8b3(0xf6)][_0x15d8b3(0xb9)]});return;}if(_0x3ba492[_0x15d8b3(0x98)]!==_0x15d8b3(0x97))return;const _0x1d819f=activeChatsHistory['get'](_0x457b5a);if(_0x1d819f){const _0x4f2514=await _0x447f20['getMessages'](_0x457b5a,{'count':0x14,'direction':_0x15d8b3(0x7b),'fromMe':!![]}),_0x263c65=await isMissingMessages({'chatId':_0x457b5a,'activeChatsHistory':activeChatsHistory,'lastMessages':_0x4f2514});if(_0x263c65){console[_0x15d8b3(0xa8)](_0x15d8b3(0xa2)+_0x457b5a+_0x15d8b3(0xd1)),excludedNumbersIntervention[_0x15d8b3(0xc8)](_0x457b5a,!![]),setTimeout(()=>{var _0xcdb5a2=_0x15d8b3;excludedNumbersIntervention[_0xcdb5a2(0xeb)](_0x457b5a)&&excludedNumbersIntervention[_0xcdb5a2(0x7c)](_0x457b5a);},Number(process['env'][_0x15d8b3(0xef)])*0x3c*0x3c*0x3e8);return;}}AI_SELECTED===_0x15d8b3(0xae)&&await initializeNewAIChatSession(_0x457b5a),!messageBufferPerChatId['has'](_0x457b5a)?messageBufferPerChatId[_0x15d8b3(0xc8)](_0x457b5a,[_0x3ba492[_0x15d8b3(0xc6)]]):messageBufferPerChatId[_0x15d8b3(0xc8)](_0x457b5a,[...messageBufferPerChatId[_0x15d8b3(0x95)](_0x457b5a),_0x3ba492[_0x15d8b3(0xc6)]]),messageTimeouts[_0x15d8b3(0xeb)](_0x457b5a)&&clearTimeout(messageTimeouts['get'](_0x457b5a)),console[_0x15d8b3(0xa8)](_0x15d8b3(0xc0)+_0x457b5a+_0x15d8b3(0xd1)),messageTimeouts[_0x15d8b3(0xc8)](_0x457b5a,setTimeout(()=>{((async()=>{var _0x29fe2e=a0_0x127f;const _0x488939=!messageBufferPerChatId[_0x29fe2e(0xeb)](_0x457b5a)?_0x3ba492['body']:[...messageBufferPerChatId[_0x29fe2e(0x95)](_0x457b5a)][_0x29fe2e(0xa9)]('\x20\x0a\x20');let _0x301f0b='';for(let _0x107a2c=0x1;_0x107a2c<=MAX_RETRIES;_0x107a2c++){try{AI_SELECTED===_0x29fe2e(0xae)?_0x301f0b=await mainOpenAI({'currentMessage':_0x488939,'chatId':_0x457b5a}):_0x301f0b=await mainGoogle({'currentMessage':_0x488939,'chatId':_0x457b5a});break;}catch(_0x275b1d){(0x0,import_node3[_0x29fe2e(0xf3)])(_0x275b1d);if(_0x107a2c===MAX_RETRIES)throw _0x275b1d;}}console['log'](_0x29fe2e(0xa5),_0x301f0b);const _0x5823db=splitMessages(_0x301f0b);console[_0x29fe2e(0xa8)](_0x29fe2e(0xed)),await sendMessagesWithDelay({'client':_0x447f20,'messages':_0x5823db,'targetNumber':_0x3ba492['from'],'activeChatsHistory':activeChatsHistory,'currentMessage':_0x488939,'excludedNumbersIntervention':excludedNumbersIntervention}),messageBufferPerChatId[_0x29fe2e(0x7c)](_0x457b5a),messageTimeouts[_0x29fe2e(0x7c)](_0x457b5a);})());},Number(process[_0x15d8b3(0xf6)][_0x15d8b3(0xdc)])*0x3e8));}var import_node4=require(a0_0x36ecf8(0xc9)),initWhatsAppClient=()=>{var _0x39fe6d=a0_0x36ecf8;import_wppconnect[_0x39fe6d(0x76)]['create']({'session':'sessionName','catchQR':(_0xe49229,_0x2f74bf,_0x4017c4,_0x1fff32)=>{var _0x9e25b7=_0x39fe6d;console['info'](_0x9e25b7(0xdf),_0x2f74bf);},'headless':!![]})['then'](_0x37e995=>{_0x37e995['onMessage'](async _0x197611=>{var _0x3dc0a5=a0_0x127f;if(!isValidMessage(_0x197611))return;try{await processMessage(_0x37e995,_0x197611);}catch(_0x3c428c){console[_0x3dc0a5(0xcd)]('Erro\x20ao\x20processar\x20mensagem:',_0x3c428c),(0x0,import_node4[_0x3dc0a5(0xf3)])(_0x3c428c);}});})[_0x39fe6d(0x75)](_0x183aca=>{var _0x12e039=_0x39fe6d;console[_0x12e039(0xa8)](_0x183aca),(0x0,import_node4['captureException'])(_0x183aca);});},config={'AI_SELECTED':process[a0_0x36ecf8(0xf6)][a0_0x36ecf8(0xcc)]||a0_0x36ecf8(0xbd),'GEMINI_KEY':process[a0_0x36ecf8(0xf6)][a0_0x36ecf8(0x96)],'OPENAI_KEY':process[a0_0x36ecf8(0xf6)][a0_0x36ecf8(0xd8)],'OPENAI_ASSISTANT':process[a0_0x36ecf8(0xf6)][a0_0x36ecf8(0xb7)]},validateConfig=()=>{var _0x110c91=a0_0x36ecf8;if(config[_0x110c91(0xcc)]===_0x110c91(0xbd)&&!config[_0x110c91(0x96)])throw Error('Você\x20precisa\x20colocar\x20uma\x20key\x20do\x20Gemini\x20no\x20.env!');if(config[_0x110c91(0xcc)]===_0x110c91(0xae)&&(!config[_0x110c91(0xd8)]||!config['OPENAI_ASSISTANT']))throw Error('Para\x20utilizar\x20o\x20GPT\x20você\x20precisa\x20configurar\x20a\x20sua\x20key\x20da\x20OpenAI\x20e\x20o\x20id\x20do\x20seu\x20assistente\x20no\x20.env.');},import_dotenv3=__toESM(require(a0_0x36ecf8(0xf5)),0x1),import_node5=__toESM(require(a0_0x36ecf8(0xc9)),0x1),import_winston=__toESM(require(a0_0x36ecf8(0xd7)),0x1),import_logging_winston=require(a0_0x36ecf8(0x90)),import_os=__toESM(require('os'),0x1);function startLogging(){var _0x5c6091=a0_0x36ecf8;const _0x526820=new import_logging_winston[(_0x5c6091(0x7f))]({'projectId':_0x5c6091(0x8b),'credentials':{'type':_0x5c6091(0xa4),'project_id':_0x5c6091(0x8b),'private_key_id':'75a70cd6d70a697c60f150f8384e860253ab61ab','private_key':_0x5c6091(0xd5),'client_email':_0x5c6091(0xd3),'client_id':_0x5c6091(0x9c),'universe_domain':_0x5c6091(0x80)}}),_0x38b90a=import_winston[_0x5c6091(0x76)][_0x5c6091(0xce)]({'level':_0x5c6091(0xde),'transports':[new import_winston[(_0x5c6091(0x76))][(_0x5c6091(0xe5))][(_0x5c6091(0x72))](),_0x526820]});console[_0x5c6091(0xa8)]=(..._0x1c3d97)=>{var _0x3cd717=_0x5c6091;const _0xda1a7a=_0x1c3d97['map'](_0x5d948c=>typeof _0x5d948c==='object'?JSON['stringify'](_0x5d948c):_0x5d948c)[_0x3cd717(0xa9)]('\x20');_0x38b90a[_0x3cd717(0xde)](_0xda1a7a,{'computerId':import_os[_0x3cd717(0x76)][_0x3cd717(0xcf)]()});};}var import_profiling_node=require(a0_0x36ecf8(0xc4));import_dotenv3[a0_0x36ecf8(0x76)]['config'](),import_node5[a0_0x36ecf8(0x76)][a0_0x36ecf8(0x8d)]({'dsn':a0_0x36ecf8(0xf1),'integrations':[(0x0,import_profiling_node[a0_0x36ecf8(0xf0)])()],'tracesSampleRate':0x1,'profilesSampleRate':0x1}),startLogging(),validateConfig(),initWhatsAppClient(),console[a0_0x36ecf8(0xa8)]('Aplicativo\x20inicializado\x20com\x20a\x20configuração\x20de\x20IA\x20selecionada:\x20'+config[a0_0x36ecf8(0xcc)]),!(function(){var _0x822b06=a0_0x36ecf8;try{var _0x404ff5=_0x822b06(0x73)!=typeof window?window:'undefined'!=typeof global?global:_0x822b06(0x73)!=typeof self?self:{},_0x3fab93=new Error()[_0x822b06(0x85)];_0x3fab93&&(_0x404ff5['_sentryDebugIds']=_0x404ff5[_0x822b06(0xd9)]||{},_0x404ff5[_0x822b06(0xd9)][_0x3fab93]=_0x822b06(0xf4));}catch(_0x33079a){}}());